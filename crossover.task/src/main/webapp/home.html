<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<link rel="stylesheet" type="text/css" href="css/main.css" />
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!-- <script src="js/main.js"></script> -->

<title>Remote Java Compilation</title>
</head>
<body>

	<div class="main">
		<div class="content">
			<div align="right">
				<i>Hello, User</i> <a href="./logout">Logout</a>
			</div>

			<i>Uploading File With Ajax</i><br />
			<form id="form2" method="post" action="./rest/upload"
				enctype="multipart/form-data">
				<!-- File input -->
				<input name="file2" id="file2" type="file" /><br />
			</form>

			<button value="Submit" onclick="uploadFormData()">Upload</button>
			<i>Using FormData Object</i>

			<div id="result"></div>

		</div>
	</div>
	<script type="text/javascript">
		function uploadFormData() {
			$('#result').html('');

			var oMyForm = new FormData();
			oMyForm.append("file", file2.files[0]);

			$.ajax({
				url : './upload',
				data : oMyForm,
				dataType : 'json',
				processData : false,
				contentType : false,
				type : 'POST',
				success : function(data) {
					$('#result').html(data.message);
					if (data.success) {
						requestCompilation(data.id);
					}
				}
			});
		}
		function requestCompilation(fileId) {
			$.ajax({
				url : './compile',
				data :  {fileId: fileId},
				dataType : 'json',
				complete : function(response) {
					if (response.status == 200) {
						var data = response.responseJSON;
						$('#result').html(data.output);
					}
				}
			})
		}
	</script>
</body>
</html>